 #-*-coding:utf-8 -*-
import csv

def process(d, i):
	if i not in d.keys():
		return 0
	count = 0
	for t in d[i]:
		count += 1 + process(d, t)
	return count

file1 = open("graph_tensorflow.csv")
reader = csv.reader(file1)
next(reader)
d = dict()
s = set()
for row in reader:
	try:
		s.add(row[1])
		s.add(row[0])
		if row[0] not in d.keys():
			d[row[0]] = [row[1]]
		else:
			d[row[0]].append(row[1])
	except:
		continue
d2 = dict()
for k in s:
	d2[k] = 0
for k in d.keys():
	out_degree = 0
	for i in d[k]:	
		out_degree += 1+process(d, i)
	d2[k] = out_degree

d2 = sorted(d2.items(), key=lambda x: x[1], reverse=True)

file2 = open("outdegree_tensorflow.csv", 'w')
writer = csv.writer(file2)	
writer.writerow(['node', 'weight'])
for k in d2:
	writer.writerow([k[0], k[1]])
file1.close()
file2.close()

